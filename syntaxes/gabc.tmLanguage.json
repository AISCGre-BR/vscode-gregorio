{
  "$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
  "name": "GABC",
  "scopeName": "source.gabc",
  "fileTypes": ["gabc"],
  "patterns": [
    { "include": "#header" },
    { "include": "#section-separator" },
    { "include": "#syllable-text" },
    { "include": "#note-group" }
  ],
  "repository": {
    "header": {
      "patterns": [
        {
          "name": "meta.header.gabc",
          "begin": "^([a-zA-Z][a-zA-Z0-9_-]*)\\s*(:)\\s*",
          "beginCaptures": {
            "1": { "name": "entity.name.tag.gabc" },
            "2": { "name": "punctuation.separator.gabc" }
          },
          "end": ";|$",
          "endCaptures": {
            "0": { "name": "punctuation.terminator.gabc" }
          },
          "patterns": [
            { "include": "#header-value" }
          ]
        }
      ]
    },
    "header-value": {
      "patterns": [
        {
          "name": "constant.numeric.gabc",
          "match": "\\b\\d+\\b"
        },
        {
          "name": "string.unquoted.gabc",
          "match": "[^;\\n]+"
        }
      ]
    },
    "section-separator": {
      "name": "keyword.control.separator.gabc",
      "match": "^%%$"
    },
    "syllable-text": {
      "patterns": [
        { "include": "#syllable-style" },
        { "include": "#syllable-special" }
      ]
    },
    "syllable-style": {
      "patterns": [
        {
          "name": "markup.bold.gabc",
          "begin": "<b>",
          "end": "</b>",
          "captures": { "0": { "name": "punctuation.definition.tag.gabc" } }
        },
        {
          "name": "markup.italic.gabc",
          "begin": "<i>",
          "end": "</i>",
          "captures": { "0": { "name": "punctuation.definition.tag.gabc" } }
        },
        {
          "name": "markup.underline.gabc",
          "begin": "<ul>",
          "end": "</ul>",
          "captures": { "0": { "name": "punctuation.definition.tag.gabc" } }
        },
        {
          "name": "markup.heading.gabc",
          "begin": "<sc>",
          "end": "</sc>",
          "captures": { "0": { "name": "punctuation.definition.tag.gabc" } }
        },
        {
          "name": "markup.raw.gabc",
          "begin": "<tt>",
          "end": "</tt>",
          "captures": { "0": { "name": "punctuation.definition.tag.gabc" } }
        },
        {
          "name": "markup.underline.link.gabc",
          "begin": "<c>",
          "end": "</c>",
          "captures": { "0": { "name": "punctuation.definition.tag.gabc" } }
        }
      ]
    },
    "syllable-special": {
      "patterns": [
        {
          "name": "string.other.verbatim.gabc",
          "begin": "<v>",
          "end": "</v>",
          "captures": { "0": { "name": "punctuation.definition.tag.gabc" } }
        },
        {
          "name": "string.other.above-lines.gabc",
          "begin": "<alt>",
          "end": "</alt>",
          "captures": { "0": { "name": "punctuation.definition.tag.gabc" } }
        },
        {
          "name": "string.other.special-char.gabc",
          "begin": "<sp>",
          "end": "</sp>",
          "captures": { "0": { "name": "punctuation.definition.tag.gabc" } }
        }
      ]
    },
    "note-group": {
      "name": "meta.note-group.gabc",
      "begin": "\\(",
      "end": "\\)",
      "beginCaptures": { "0": { "name": "punctuation.section.group.begin.gabc" } },
      "endCaptures": { "0": { "name": "punctuation.section.group.end.gabc" } },
      "patterns": [
        { "include": "#clef" },
        { "include": "#nabc-section" },
        { "include": "#gabc-content" }
      ]
    },
    "gabc-content": {
      "patterns": [
        { "include": "#alteration" },
        { "include": "#pitch" },
        { "include": "#modifier" },
        { "include": "#bar" },
        { "include": "#spacing" },
        { "include": "#attribute" },
        { "include": "#line-break" }
      ]
    },
    "nabc-section": {
      "name": "meta.nabc-section.gabc",
      "begin": "\\|",
      "end": "(?=\\||\\))",
      "beginCaptures": { "0": { "name": "keyword.operator.nabc-separator.gabc" } },
      "contentName": "meta.nabc-content.gabc"
    },
    "clef": {
      "patterns": [
        {
          "name": "keyword.control.clef.gabc",
          "match": "c[b1-4]|f[1-4]|cb[b1-4]"
        }
      ]
    },
    "alteration": {
      "patterns": [
        {
          "name": "constant.language.alteration.gabc",
          "match": "[xy#]|\\([xy#]\\)"
        }
      ]
    },
    "pitch": {
      "patterns": [
        {
          "name": "constant.character.pitch.gabc",
          "match": "[a-mA-M]"
        }
      ]
    },
    "modifier": {
      "patterns": [
        {
          "name": "storage.type.modifier.gabc",
          "match": "[owOqWvVs~<>_]"
        }
      ]
    },
    "bar": {
      "patterns": [
        {
          "name": "punctuation.separator.bar.gabc",
          "match": "[`,;:`:|::|\\[\\]]|r0|r[1-9]"
        }
      ]
    },
    "spacing": {
      "patterns": [
        {
          "name": "keyword.operator.spacing.gabc",
          "match": "!|@|/[0-9]*|//[0-9]*"
        }
      ]
    },
    "attribute": {
      "patterns": [
        {
          "comment": "LaTeX verbatim attributes: nv (note), gv (glyph), ev (element)",
          "name": "meta.attribute.verbatim.gabc",
          "begin": "\\[(nv|gv|ev):",
          "end": "\\]",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.attribute.begin.gabc" },
            "1": { "name": "entity.other.attribute-name.gabc" }
          },
          "endCaptures": { "0": { "name": "punctuation.definition.attribute.end.gabc" } },
          "patterns": [
            {
              "name": "meta.embedded.inline.latex",
              "contentName": "source.latex",
              "begin": "(?<=:)",
              "end": "(?=\\])",
              "patterns": [
                { "include": "text.tex.latex" }
              ]
            }
          ]
        },
        {
          "comment": "Above lines text attribute with LaTeX support",
          "name": "meta.attribute.alt.gabc",
          "begin": "\\[(alt):",
          "end": "\\]",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.attribute.begin.gabc" },
            "1": { "name": "entity.other.attribute-name.gabc" }
          },
          "endCaptures": { "0": { "name": "punctuation.definition.attribute.end.gabc" } },
          "patterns": [
            {
              "name": "meta.embedded.inline.latex",
              "contentName": "source.latex",
              "begin": "(?<=:)",
              "end": "(?=\\])",
              "patterns": [
                { "include": "text.tex.latex" }
              ]
            }
          ]
        },
        {
          "comment": "Attributes with unbalanced braces: ob, ub, ocb, ocba, oll, ull, oslur, uslur, oh, uh",
          "name": "meta.attribute.braces.gabc",
          "begin": "\\[(ob|ub|ocb|ocba|oll|ull|oslur|uslur|oh|uh):",
          "end": "\\]",
          "beginCaptures": {
            "1": { "name": "entity.other.attribute-name.gabc" }
          },
          "contentName": "string.unquoted.attribute-value.gabc",
          "patterns": [
            {
              "comment": "Numbers in attribute values",
              "match": "\\d+(\\.\\d+)?",
              "name": "constant.numeric.gabc"
            },
            {
              "comment": "Semicolon separator",
              "match": ";",
              "name": "punctuation.separator.parameter.gabc"
            }
          ]
        },
        {
          "comment": "Generic attributes",
          "name": "meta.attribute.gabc",
          "begin": "\\[([a-z]+):",
          "end": "\\]",
          "beginCaptures": {
            "0": { "name": "punctuation.definition.attribute.begin.gabc" },
            "1": { "name": "entity.other.attribute-name.gabc" }
          },
          "endCaptures": { "0": { "name": "punctuation.definition.attribute.end.gabc" } },
          "contentName": "string.unquoted.attribute-value.gabc",
          "patterns": [
            {
              "comment": "Numbers in attribute values",
              "match": "\\d+(\\.\\d+)?",
              "name": "constant.numeric.gabc"
            },
            {
              "comment": "Semicolon separator",
              "match": ";",
              "name": "punctuation.separator.parameter.gabc"
            }
          ]
        },
        {
          "comment": "Attributes without values (e.g., nocustos)",
          "name": "meta.attribute.gabc",
          "match": "\\[([a-z]+)\\]",
          "captures": {
            "0": { "name": "punctuation.definition.attribute.gabc" },
            "1": { "name": "entity.other.attribute-name.gabc" }
          }
        }
      ]
    },
    "line-break": {
      "patterns": [
        {
          "name": "keyword.control.linebreak.gabc",
          "match": "z0?|Z0?"
        }
      ]
    }
  }
}
